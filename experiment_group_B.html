
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>印象評価アンケート</title>
<style>
    body { font-family: "Helvetica Neue", Arial, sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
    .container { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 700px; width: 100%; min-height: 500px; display: flex; flex-direction: column; justify-content: center; position: relative; }
    
    .step { display: none; animation: fadeIn 0.3s ease-in-out; }
    .step.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    h1 { text-align: center; color: #333; font-size: 1.5em; }
    .question-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }
    
    .section-title { text-align: center; font-size: 1.3em; font-weight: bold; color: #3B82F6; margin: 40px 0; }
    .text-display { font-size: 1.6em; font-weight: bold; padding: 20px; background: #f8fafc; border-radius: 8px; margin: 20px 0; text-align: center; color: #1a1a1a; border: 1px solid #e2e8f0; }
    
    audio { width: 100%; margin-top: 10px; }
    
    /* 評価スケールのスタイル (-3 to +3) */
    .rating-scale-container { margin: 30px 0; text-align: center; }
    .scale-labels { display: flex; justify-content: space-between; margin-bottom: 10px; font-weight: bold; color: #555; padding: 0 10px; }
    .scale-label-neg { color: #e11d48; }
    .scale-label-pos { color: #2563eb; }
    
    .rating-options { display: flex; justify-content: space-between; align-items: center; background: #f9fafb; padding: 15px; border-radius: 50px; border: 1px solid #eee; }
    .rating-item { flex: 1; text-align: center; position: relative; }
    .rating-item input { 
        transform: scale(1.8); 
        cursor: pointer; 
        margin-bottom: 5px;
        accent-color: #4b5563;
    }
    /* マイナス側の色 */
    .rating-item input[value^="-"] { accent-color: #e11d48; }
    /* プラス側の色 */
    .rating-item input[value^="+"] { accent-color: #2563eb; } /* valueは数値だけどCSSセレクタ用に工夫が必要かも、今回はシンプルに */
    
    .rating-item span { display: block; font-weight: bold; color: #666; font-size: 1.1em; }

    .button-group { display: flex; justify-content: space-between; margin-top: 30px; gap: 10px; }
    .btn { flex: 1; padding: 15px; border: none; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: background 0.2s; }
    .btn-next { background: #3B82F6; color: white; }
    .btn-next:hover { background: #2563EB; }
    .btn-prev { background: #e2e8f0; color: #4b5563; }
    .btn-prev:hover { background: #cbd5e1; }
    
    .instruction-box { background-color: #fff3cd; border: 1px solid #ffeeba; padding: 15px; border-radius: 5px; margin-bottom: 20px; color: #856404; }
</style>
</head>
<body>
<div class="container">

    <div id="step-0" class="step active">
        <h1>チャットに関する印象評価</h1>
        <p>名前を入力し、「開始する」ボタンを押してください。</p>
        <div class="instruction-box">
            <b>【回答の方法】</b><br>
            提示されるメッセージ（または音声）から受ける印象が、<br>
            <b>「ネガティブ（マイナス）」か「ポジティブ（プラス）」か</b>を評価してください。<br><br>
            <b>-3（非常にネガティブ）</b> 〜 <b>0（中立）</b> 〜 <b>+3（非常にポジティブ）</b>
        </div>
        <input type="text" id="username" placeholder="ニックネーム" style="width:100%; padding:15px; margin: 20px 0; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; font-size: 1.1em;">
        <button class="btn btn-next" style="width:100%" onclick="nextStep(0)">実験を開始する</button>
    </div>

    <form id="experimentForm">
<div id="step-1" class="step">
<div class="section-title">【前半】テキストのみを見て回答してください</div>
<p style="text-align:center;">準備ができたら「次へ」を押してください。</p><div class="button-group">
<button type="button" class="btn btn-next" onclick="nextStep(1)">次へ</button>
</div></div>

<div id="step-2" class="step question-step">
<div class="question-header"><b>質問 1 / 6</b></div>
<div style="text-align:center;">以下のメッセージを見て、直感的に感じる印象を評価してください</div>
<div class="text-display">「あとで話そう」</div>
<div class="rating-scale-container">
<div class="scale-labels"><span class="scale-label-neg">← ネガティブ (不快)</span><span class="scale-label-pos">ポジティブ (快) →</span></div>
<div class="rating-options">
<div class="rating-item"><label><input type="radio" name="q_08_text" value="-3"><br><span>-3</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_08_text" value="-2"><br><span>-2</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_08_text" value="-1"><br><span>-1</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_08_text" value="0"><br><span>0</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_08_text" value="1"><br><span>+1</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_08_text" value="2"><br><span>+2</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_08_text" value="3"><br><span>+3</span></label></div>
</div></div>
<div class="button-group">
<button type="button" class="btn btn-prev" onclick="prevStep(2)">戻る</button>
<button type="button" class="btn btn-next" onclick="nextStep(2)">次へ</button>
</div></div>

<div id="step-3" class="step question-step">
<div class="question-header"><b>質問 2 / 6</b></div>
<div style="text-align:center;">以下のメッセージを見て、直感的に感じる印象を評価してください</div>
<div class="text-display">「信じられない」</div>
<div class="rating-scale-container">
<div class="scale-labels"><span class="scale-label-neg">← ネガティブ (不快)</span><span class="scale-label-pos">ポジティブ (快) →</span></div>
<div class="rating-options">
<div class="rating-item"><label><input type="radio" name="q_09_text" value="-3"><br><span>-3</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_09_text" value="-2"><br><span>-2</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_09_text" value="-1"><br><span>-1</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_09_text" value="0"><br><span>0</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_09_text" value="1"><br><span>+1</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_09_text" value="2"><br><span>+2</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_09_text" value="3"><br><span>+3</span></label></div>
</div></div>
<div class="button-group">
<button type="button" class="btn btn-prev" onclick="prevStep(3)">戻る</button>
<button type="button" class="btn btn-next" onclick="nextStep(3)">次へ</button>
</div></div>

<div id="step-4" class="step question-step">
<div class="question-header"><b>質問 3 / 6</b></div>
<div style="text-align:center;">以下のメッセージを見て、直感的に感じる印象を評価してください</div>
<div class="text-display">「相変わらずだね」</div>
<div class="rating-scale-container">
<div class="scale-labels"><span class="scale-label-neg">← ネガティブ (不快)</span><span class="scale-label-pos">ポジティブ (快) →</span></div>
<div class="rating-options">
<div class="rating-item"><label><input type="radio" name="q_10_text" value="-3"><br><span>-3</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_10_text" value="-2"><br><span>-2</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_10_text" value="-1"><br><span>-1</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_10_text" value="0"><br><span>0</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_10_text" value="1"><br><span>+1</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_10_text" value="2"><br><span>+2</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_10_text" value="3"><br><span>+3</span></label></div>
</div></div>
<div class="button-group">
<button type="button" class="btn btn-prev" onclick="prevStep(4)">戻る</button>
<button type="button" class="btn btn-next" onclick="nextStep(4)">次へ</button>
</div></div>

<div id="step-5" class="step">
<div class="section-title">【後半】音声を聴いて回答してください</div>
<p style="text-align:center;">準備ができたら「次へ」を押してください。</p><div class="button-group">
<button type="button" class="btn btn-prev" onclick="prevStep(5)">戻る</button>
<button type="button" class="btn btn-next" onclick="nextStep(5)">次へ</button>
</div></div>

<div id="step-6" class="step question-step">
<div class="question-header"><b>質問 4 / 6</b></div>
<div style="text-align:center;">以下の音声を再生し、直感的に感じる印象を評価してください</div>
<audio controls src="experiment_materials_joy_max/02_わかった_joy_max.mp3"></audio>
<div class="text-display">「わかった」</div>
<div class="rating-scale-container">
<div class="scale-labels"><span class="scale-label-neg">← ネガティブ (不快)</span><span class="scale-label-pos">ポジティブ (快) →</span></div>
<div class="rating-options">
<div class="rating-item"><label><input type="radio" name="q_02_audio" value="-3"><br><span>-3</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_02_audio" value="-2"><br><span>-2</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_02_audio" value="-1"><br><span>-1</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_02_audio" value="0"><br><span>0</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_02_audio" value="1"><br><span>+1</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_02_audio" value="2"><br><span>+2</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_02_audio" value="3"><br><span>+3</span></label></div>
</div></div>
<div class="button-group">
<button type="button" class="btn btn-prev" onclick="prevStep(6)">戻る</button>
<button type="button" class="btn btn-next" onclick="nextStep(6)">次へ</button>
</div></div>

<div id="step-7" class="step question-step">
<div class="question-header"><b>質問 5 / 6</b></div>
<div style="text-align:center;">以下の音声を再生し、直感的に感じる印象を評価してください</div>
<audio controls src="experiment_materials_joy_max/04_それでいいよ_joy_max.mp3"></audio>
<div class="text-display">「それでいいよ」</div>
<div class="rating-scale-container">
<div class="scale-labels"><span class="scale-label-neg">← ネガティブ (不快)</span><span class="scale-label-pos">ポジティブ (快) →</span></div>
<div class="rating-options">
<div class="rating-item"><label><input type="radio" name="q_04_audio" value="-3"><br><span>-3</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_04_audio" value="-2"><br><span>-2</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_04_audio" value="-1"><br><span>-1</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_04_audio" value="0"><br><span>0</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_04_audio" value="1"><br><span>+1</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_04_audio" value="2"><br><span>+2</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_04_audio" value="3"><br><span>+3</span></label></div>
</div></div>
<div class="button-group">
<button type="button" class="btn btn-prev" onclick="prevStep(7)">戻る</button>
<button type="button" class="btn btn-next" onclick="nextStep(7)">次へ</button>
</div></div>

<div id="step-8" class="step question-step">
<div class="question-header"><b>質問 6 / 6</b></div>
<div style="text-align:center;">以下の音声を再生し、直感的に感じる印象を評価してください</div>
<audio controls src="experiment_materials_joy_max/06_へー、そうなんだ_joy_max.mp3"></audio>
<div class="text-display">「へー、そうなんだ」</div>
<div class="rating-scale-container">
<div class="scale-labels"><span class="scale-label-neg">← ネガティブ (不快)</span><span class="scale-label-pos">ポジティブ (快) →</span></div>
<div class="rating-options">
<div class="rating-item"><label><input type="radio" name="q_06_audio" value="-3"><br><span>-3</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_06_audio" value="-2"><br><span>-2</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_06_audio" value="-1"><br><span>-1</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_06_audio" value="0"><br><span>0</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_06_audio" value="1"><br><span>+1</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_06_audio" value="2"><br><span>+2</span></label></div>
<div class="rating-item"><label><input type="radio" name="q_06_audio" value="3"><br><span>+3</span></label></div>
</div></div>
<div class="button-group">
<button type="button" class="btn btn-prev" onclick="prevStep(8)">戻る</button>
<button type="button" class="btn btn-next" onclick="downloadCSV()">完了</button>
</div></div>

    </form>
</div>

<script>
function nextStep(currentId) {
    // 入力チェック
    if (currentId === 0) {
        const name = document.getElementById('username').value;
        if (!name) { alert("お名前を入力してください"); return; }
    } else if (document.getElementById('step-' + currentId).classList.contains('question-step')) {
        // ラジオボタンチェック
        const stepDiv = document.getElementById('step-' + currentId);
        const inputs = stepDiv.querySelectorAll('input[type="radio"]');
        let checked = false;
        inputs.forEach(opt => { if(opt.checked) checked = true; });
        if (!checked) { alert("評価を選択してください"); return; }
    }

    // 画面遷移
    document.getElementById('step-' + currentId).classList.remove('active');
    const nextId = currentId + 1;
    const nextEl = document.getElementById('step-' + nextId);
    if (nextEl) { nextEl.classList.add('active'); }
}

function prevStep(currentId) {
    document.getElementById('step-' + currentId).classList.remove('active');
    const prevId = currentId - 1;
    const prevEl = document.getElementById('step-' + prevId);
    if (prevEl) { prevEl.classList.add('active'); }
}

function downloadCSV() {
    const name = document.getElementById('username').value;
    
    // CSVヘッダー: 質問ID, 条件, 評価スコア(-3~3)
    let csvContent = "data:text/csv;charset=utf-8,QuestionID,Condition,ValenceScore\n";
    const form = document.getElementById('experimentForm');
    const formData = new FormData(form);

    for (let [key, value] of formData.entries()) {
        // key例: "q_02_text"
        const parts = key.split('_'); 
        const qId = parts[1];
        const condition = parts[2];
        
        csvContent += `${qId},${condition},${value}\n`;
    }

    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", `result_${name}.csv`);
    document.body.appendChild(link);
    link.click();
    alert("回答ありがとうございます！ダウンロードされたファイルを実験者に送ってください。");
}
</script>
</body>
</html>
